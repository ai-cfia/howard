
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>Secret management - Howard</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#secret-management" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Howard" class="md-header__button md-logo" aria-label="Howard" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Howard
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Secret management
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/howard/en/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/howard/fr/" hreflang="fr" class="md-select__link">
              French
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ai-cfia/howard" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    ai-cfia/howard
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Howard" class="md-nav__button md-logo" aria-label="Howard" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Howard
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ai-cfia/howard" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    ai-cfia/howard
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../adr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ADR
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration / Implementation
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#azure-key-vault-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Azure Key Vault Architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secret-management-process" class="md-nav__link">
    <span class="md-ellipsis">
      Secret management process
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-read-update-and-delete-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      Create, read, update, and delete secrets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create, read, update, and delete secrets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#steps-to-update-secret-values-using-the-azure-portal" class="md-nav__link">
    <span class="md-ellipsis">
      Steps to Update Secret Values Using the Azure Portal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps-to-update-secrets-injected-into-pods" class="md-nav__link">
    <span class="md-ellipsis">
      Steps to Update Secrets Injected into Pods
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#argo-cd-vault-plugin-avp" class="md-nav__link">
    <span class="md-ellipsis">
      Argo CD Vault plugin (AVP)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="secret-management">Secret management</h1>
<h2 id="introduction">Introduction</h2>
<p>Secrets are sensitive pieces of information that should be protected from
unauthorized access. In the context of a Kubernetes cluster, secrets are used to
store sensitive data such as passwords, tokens, and keys. To allow for secure
and efficient management of secrets, we are using Azure Key Vault. Azure Key
Vault is a tool designed to manage secrets and protect sensitive data. It
provides a centralized way to manage access to secrets. This document provides
an overview of the secret management process and the role of Azure Key Vault in
securing and managing secrets in the Kubernetes cluster.</p>
<h2 id="azure-key-vault-architecture">Azure Key Vault Architecture</h2>
<p>Azure Key Vault is a cloud-based service that provides secure storage for
secrets, keys, and certificates. It is designed to help safeguard cryptographic
keys and secrets used by cloud applications and services. Key Vault simplifies
the key management process, enabling you to maintain control of keys and other
secrets by centralizing storage and access.</p>
<p>The current configuration allows Azure Key Vault to inject secrets into pods
using the CSI (Container Storage Interface) Secret Store driver. This provides a
secure way to manage secrets in the Kubernetes cluster and ensures that
sensitive data is protected from unauthorized access.</p>
<p>The following diagram illustrates the structure of the Azure Key Vault
architecture within our setup:</p>
<p><img alt="Vault architecture diagram" src="../img/vault-argocd-architecture.svg" /></p>
<p>The following sequence diagram describes the process of how a developer can
update secrets using the Azure portal and how the secrets are injected into the
pods:</p>
<pre class="mermaid"><code>sequenceDiagram
    participant Developer
    participant FinesseRepo as Finesse Repository
    participant GHWorkflow as GitHub Workflow
    participant ContainerReg as GitHub Container Registry
    participant HowardRepo as Howard Repository
    participant ArgoInstance as ArgoCD Instance
    participant CSIProvider as CSI Secret Provider
    participant FinessePod as Finesse Pod
    participant AzureKeyVaultUI as Azure Key Vault UI
    participant AzureKeyVault as Azure Key Vault

    Developer-&gt;&gt;+FinesseRepo: 1. Pushes commits
    FinesseRepo-&gt;&gt;+GHWorkflow: Triggers workflow
    GHWorkflow-&gt;&gt;+ContainerReg: Builds and pushes new semantic version
    ArgoInstance-&gt;&gt;+ContainerReg: Checks for new image tags
    ArgoInstance-&gt;&gt;+FinessePod: Triggers synchronisation to pod
    FinessePod-&gt;&gt;+ContainerReg: Fetches image with new version tag
    FinessePod-&gt;&gt;+FinessePod: Refreshes deployment with new version
    Developer-&gt;&gt;+AzureKeyVaultUI: 2. Accesses UI to update/create secrets
    AzureKeyVaultUI-&gt;&gt;+AzureKeyVault: Commit update/creation of secrets
    Developer-&gt;&gt;+HowardRepo: 3. Commits new/updated secrets
    ArgoInstance-&gt;&gt;+HowardRepo: Checks for changes in repository
    ArgoInstance-&gt;&gt;+CSIProvider: triggers refresh on finesse namespace,&lt;br&gt; sync secrets from Azure Key Vault
    CSIProvider-&gt;&gt;+AzureKeyVault: Fetch specific version of secrets
    CSIProvider-&gt;&gt;+FinessePod: Injects secrets
    ArgoInstance-&gt;&gt;+FinessePod: 4. Trigger hard refresh</code></pre>
<h2 id="secret-management-process">Secret management process</h2>
<p>The secret management process involves the following steps:</p>
<ol>
<li>
<p><strong>Secret creation</strong>: Secrets are created and stored in Azure Key Vault using
   the Azure Key Vault CLI or API. When a secret is created, it is encrypted and
   stored in the central Key Vault server.</p>
</li>
<li>
<p><strong>Secret retrieval</strong>: Secrets are retrieved by applications and services
   using the SecretProviderClass that utilizes Managed Identity to securely
   fetch secrets from Azure Key Vault and inject them into Kubernetes pods.</p>
</li>
<li>
<p><strong>Access control</strong>: Azure Key Vault provides fine-grained access control to
   secrets, allowing administrators to define policies that specify which
   clients can access which secrets. This ensures that only authorized clients
   can access sensitive data. Currently, we are using the Managed Identity
   authentication method to authenticate hosted applications and authorize
   access to secrets.</p>
</li>
</ol>
<h2 id="create-read-update-and-delete-secrets">Create, read, update, and delete secrets</h2>
<p>Azure Key Vault provides a UI service to manage secrets. The UI service is a
web-based user interface that allows administrators to create, read, update, and
delete secrets. The service also provides a way to manage access control
policies and audit logs. The service is accessible through a web browser and is
protected by the same security mechanisms as the Key Vault service.</p>
<h3 id="steps-to-update-secret-values-using-the-azure-portal">Steps to Update Secret Values Using the Azure Portal</h3>
<ol>
<li>
<p><strong>Access the Azure Portal</strong>: Navigate to the <a href="https://portal.azure.com/">Azure
   Portal</a> in your web browser.</p>
</li>
<li>
<p><strong>Navigate to Azure Key Vault</strong>:</p>
</li>
<li>In the Azure Portal, use the search bar at the top to search for "Key
     Vaults".</li>
<li>
<p>Select your Key Vault from the list.</p>
</li>
<li>
<p><strong>Create or Update Secrets</strong>:</p>
</li>
<li>In your Key Vault, select the "Secrets" option from the left-hand menu.</li>
<li>To create a new secret, click on the "+ Generate/Import" button.</li>
<li>To update an existing secret, click on the secret name in the list and then
     click on the "New Version" button.</li>
<li>Enter the name and value for the secret. Ensure the secret name is prefixed
     with the app name (e.g., <code>librechat-jwt-secret</code>) and click "Create" or
     "Save".</li>
</ol>
<p>After updating secrets in Azure Key Vault, the secrets will be automatically
injected into the Kubernetes pods based on the <code>SecretProviderClass</code>
configuration.</p>
<h3 id="steps-to-update-secrets-injected-into-pods">Steps to Update Secrets Injected into Pods</h3>
<p>In order to update secrets that are injected into pods, you need to update the
secret manifest for the application. The secret manifest is a YAML file that
defines the secrets that are injected into the pod's environment variables. We
will use Finesse as an example.</p>
<ol>
<li><strong>Open an Issue and Create a Working Branch</strong>:</li>
<li>
<p>Open an issue with the following template: <a href="url to
     be provided when the template is created">Secrets update template</a>. You can then create a working
     branch from the issue.</p>
</li>
<li>
<p><strong>Edit the SecretProviderClass Manifest</strong>:</p>
</li>
<li>Open <code>/kubernetes/aks/apps/finesse/base/secretProviderClass.yaml</code>.</li>
<li>
<p>Update the secrets key references as needed. For example, to add a new
     secret, you can add a new key-value pair to the <code>data</code> section of the
     <code>SecretProviderClass</code> manifest:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="nt">data</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">objectName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">azure-openai-chatgpt-deployment</span><span class="w"> </span><span class="c1"># This represents the secret name in Azure Key Vault</span>
<span class="w">     </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AZURE_OPENAI_CHATGPT_DEPLOYMENT</span><span class="w"> </span><span class="c1"># This represents the environment variable name that will be injected into the pod</span>
</code></pre></div>
</li>
<li>
<p>Add the objectName and key for the new secret in the 'object' section of
      the <code>SecretProviderClass</code> manifest :</p>
<div class="highlight"><pre><span></span><code><span class="nt">objects</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">objectName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">azure-openai-chatgpt-deployment</span>
<span class="w">   </span><span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secret</span>
<span class="w">   </span><span class="l l-Scalar l-Scalar-Plain">version</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
</code></pre></div>
<p>The <code>objectName</code> represents the secret name in Azure Key Vault (ensure it
 is prefixed with the app name, e.g., the <code>key</code> represents the environment
 variable name that will be injected into the pod. You can also specify
 <code>objectVersion</code> if you want to use a specific version of the secret.</p>
</li>
</ol>
<h2 id="argo-cd-vault-plugin-avp">Argo CD Vault plugin (AVP)</h2>
<p>The <a href="https://argocd-vault-plugin.readthedocs.io/en/stable/">argocd-vault-plugin</a>
is used to manage secrets inside our deployments the Gitops way. It allows to
use <code>&lt;placeholders&gt;</code> in any YAML or JSON files that have been templated and make
use of annotations to provide the path and version of a secret inside vault. For
now, it is only being used for helm deployments that dont have integration for
secrets injection. The plugin is installed in the ArgoCD instance and is
configured to use the Azure Key Vault as the backend for secrets.</p>
<p>An example of usage is showcased inside the vouch-proxy deployment under
<code>kubernetes\aks\system\vouch-proxy\argo-app.yaml</code></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "header.autohide"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>