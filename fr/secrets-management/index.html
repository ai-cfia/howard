
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>Gestion des secrets - Howard</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gestion-des-secrets" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href=".." title="Howard" class="md-header__button md-logo" aria-label="Howard" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Howard
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Gestion des secrets
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Sélectionner la langue">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/howard/en/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/howard/fr/" hreflang="fr" class="md-select__link">
              French
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ai-cfia/howard" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    ai-cfia/howard
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Howard" class="md-nav__button md-logo" aria-label="Howard" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Howard
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ai-cfia/howard" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    ai-cfia/howard
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accueil
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../adr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ADR
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration / Implémentation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../workflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Github workflow
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-de-vault" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture de Vault
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#processus-de-gestion-des-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      Processus de gestion des secrets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creation-lecture-mise-a-jour-et-suppression-des-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      Création, lecture, mise à jour et suppression des secrets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Création, lecture, mise à jour et suppression des secrets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#etapes-pour-mettre-a-jour-les-valeurs-des-secrets-en-utilisant-linterface-utilisateur-de-vault" class="md-nav__link">
    <span class="md-ellipsis">
      Étapes pour mettre à jour les valeurs des secrets en utilisant l'interface utilisateur de Vault
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etapes-pour-mettre-a-jour-les-secrets-injectes-dans-les-pods" class="md-nav__link">
    <span class="md-ellipsis">
      Étapes pour mettre à jour les secrets injectés dans les pods
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plugin-argo-cd-vault-avp" class="md-nav__link">
    <span class="md-ellipsis">
      Plugin Argo CD Vault (AVP)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="gestion-des-secrets">Gestion des secrets</h1>
<h2 id="introduction">Introduction</h2>
<p>Les secrets sont des informations sensibles qui doivent être protégées contre
tout accès non autorisé. Dans le contexte d'un cluster Kubernetes, les secrets
sont utilisés pour stocker des données sensibles telles que des mots de passe,
des jetons et des clés. Pour permettre une gestion sécurisée et efficace des
secrets, nous utilisons HashiCorp Vault, un outil conçu pour gérer les secrets
et protéger les données sensibles. Vault fournit un moyen centralisé de gérer
l'accès aux secrets et aux clés de chiffrement, et il a également la capacité
de générer des secrets dynamiques à la demande. Ce document fournit un aperçu
du processus de gestion des secrets et du rôle de Vault dans la sécurisation
et la gestion des secrets dans le cluster Kubernetes.</p>
<h2 id="architecture-de-vault">Architecture de Vault</h2>
<p>Vault est un système hautement disponible et distribué conçu pour fournir un
stockage sécurisé et une gestion des secrets. Il est basé sur une architecture
client-serveur, avec le serveur étant le composant central qui stocke et gère
les secrets, et les clients étant les applications et services qui accèdent aux
secrets. Le serveur est responsable de l'authentification des clients, de
l'autorisation de l'accès aux secrets, et de la fourniture de services de
chiffrement et de déchiffrement. Le serveur est également responsable de générer
des secrets dynamiques à la demande, qui sont de courte durée et sont
automatiquement révoqués après une certaine période.</p>
<p>La configuration actuelle permet à Vault d'injecter des secrets dans les pods
en utilisant le plugin ArgoCD Vault. Le plugin lit les espaces réservés dans
les fichiers YAML et les remplace par les valeurs réelles des secrets provenant
de Vault. Cela offre un moyen sécurisé de gérer les secrets dans le cluster
Kubernetes et garantit que les données sensibles sont protégées contre tout
accès non autorisé.</p>
<p>Le diagramme suivant illustre la structure de l'architecture Vault au sein
de Howard: <img alt="Vault architecture diagram" src="../img/vault-argocd-architecture.svg" /></p>
<p>Le diagramme de séquence suivant décrit le processus permettant à un
développeur de mettre à jour des secrets en utilisant le service UI de Vault
et comment les secrets sont injectés dans les pods :</p>
<pre class="mermaid"><code>sequenceDiagram
    participant Developer
    participant FinesseRepo as Finesse Repository
    participant GHWorkflow as GitHub Workflow
    participant ContainerReg as GitHub Container Registry
    participant HowardRepo as Howard Repository
    participant ArgoRepoServer as ArgoCD Repo Server
    participant ArgoVaultPlugin as Argo Vault Plugin
    participant FinessePod as Finesse Pod

    participant VaultUI as Vault UI
    participant Vault as Vault Server

    Developer-&gt;&gt;+FinesseRepo: 1. Pushes commits
    FinesseRepo-&gt;&gt;+GHWorkflow: Triggers workflow
    GHWorkflow-&gt;&gt;+ContainerReg: Builds and pushes new semantic version
    GHWorkflow-&gt;&gt;+ArgoRepoServer: Triggers webhook
    ArgoRepoServer-&gt;&gt;+FinessePod: Triggers synchronisation to pod
    FinessePod-&gt;&gt;+ContainerReg: Fetches image with new version tag
    FinessePod-&gt;&gt;+FinessePod: Refreshes deployment with new version
    Developer-&gt;&gt;+VaultUI: 2. Accesses UI to update/create secrets
    VaultUI-&gt;&gt;+Vault: Commit update/creation of secrets
    Developer-&gt;&gt;+HowardRepo: 3. Commits new/updated secrets
    HowardRepo-&gt;&gt;+ArgoRepoServer: Triggers sync via webhook
    ArgoRepoServer-&gt;&gt;+ArgoVaultPlugin: triggers refresh on finesse namespace,&lt;br&gt; sync secrets from Vault
    ArgoVaultPlugin-&gt;&gt;+Vault: Fetch specific version of secrets
    ArgoVaultPlugin-&gt;&gt;+FinessePod: Injects secrets
    Developer-&gt;&gt;+FinessePod: 4. Trigger hard refresh through argoCD</code></pre>
<p>Veuillez noter que le développeur doit déclencher un rafraîchissement complet
du pod pour refléter les modifications des secrets. Cela se fait dans
l'interface utilisateur d'ArgoCD, mais nous travaillons sur un moyen
d'automatiser ce processus.</p>
<h2 id="processus-de-gestion-des-secrets">Processus de gestion des secrets</h2>
<p>The secret management process involves the following steps:</p>
<ol>
<li>
<p><strong>Création des secrets</strong>: Les secrets sont créés et stockés dans Vault en
    utilisant l'interface CLI de Vault ou  l'API. Lorsqu'un secret est créé,
    il est chiffré et stocké dans le serveur central Vault.</p>
</li>
<li>
<p><strong>Récupération des secrets</strong>: Les applications et services peuvent récupérer les
    secrets depuis Vault en utilisant l'interface CLI de Vault ou l'API.
    Lorsqu'un secret est récupéré, il est déchiffré et renvoyé au client
    de manière sécurisée.</p>
</li>
<li>
<p><strong>Génération de secrets dynamiques</strong>: Vault has the ability to generate
    dynamic secrets on demand. This means that instead of
    storing static secrets in Vault, Vault can generate short-lived secrets
    that are automatically revoked after a certain period of time. This
    provides an additional layer of security and reduces the risk of
    unauthorized access to secrets.</p>
</li>
<li>
<p><strong>Contrôle d'accès</strong>: Vault fournit un contrôle d'accès granulaire
    aux secrets, permettant aux administrateurs de définir des politiques
    qui spécifient quels clients peuvent accéder à quels secrets. Cela
    garantit que seuls les clients autorisés peuvent accéder aux données
    sensibles. Actuellement, nous utilisons la méthode d’authentification
    Kubernetes pour authentifier les applications hébergées et autoriser
    l'accès aux secrets. En ce qui concerne les utilisateurs humains,
    nous utilisons la méthode d'authentification GitHub pour
    authentifier et autoriser l'accès aux secrets.</p>
</li>
</ol>
<h2 id="creation-lecture-mise-a-jour-et-suppression-des-secrets">Création, lecture, mise à jour et suppression des secrets</h2>
<p>Vault fournit un service d'interface utilisateur pour gérer les secrets.
Le service d'interface utilisateur est une interface utilisateur web qui
permet aux administrateurs de créer, lire, mettre à jour et supprimer des
secrets. Le service fournit également un moyen de gérer les politiques de
contrôle d'accès et les journaux d'audit. Le service est accessible via un
navigateur web et est protégé par les mêmes mécanismes de sécurité
que le serveur Vault.</p>
<h3 id="etapes-pour-mettre-a-jour-les-valeurs-des-secrets-en-utilisant-linterface-utilisateur-de-vault">Étapes pour mettre à jour les valeurs des secrets en utilisant l'interface utilisateur de Vault</h3>
<ol>
<li>Afin d'accéder au service d'interface utilisateur de Vault, vous devez
   disposer des autorisations appropriées et accéder à l'URL de Vault.
   Elle est actuellement configurée pour donner accès à tout membre de
   l'organisation ai-cfia sur Github.</li>
<li>Générez un jeton d'accès personnel (PAT) sur GitHub et utilisez-le
   pour vous authentifier au service d'interface utilisateur de
   Vault. La portée du jeton devrait être: <img alt="PAT token
   scope" src="../img/pat-token-scope.png" /></li>
<li>Accédez au service d'interface utilisateur de Vault en naviguant vers l'URL
   de Vault dans un navigateur web. Vous serez invité à vous authentifier en
   utilisant votre jeton PAT de GitHub.</li>
<li>Une fois authentifié, vous pourrez créer, lire, mettre à jour et
   supprimer des secrets en utilisant le service d'interface utilisateur.
   Il vous suffit de naviguer vers le moteur de secrets PV et de suivre le
   chemin jusqu'aux secrets de vos applications. Le moteur de secrets PV est
   un magasin clé-valeur qui vous permet de stocker et de gérer les secrets
   pour vos applications.<img alt="PV secret engine" src="../img/pv-secret-engine.png" /></li>
<li>Une fois dans le répertoire des secrets de votre application, cliquez
   simplement sur 'create new version' (créer une nouvelle version) et vous
   pourrez ajouter, mettre à jour ou supprimer des secrets selon
   vos besoins.<img alt="Create new secret" src="../img/create-new-secret.png" /></li>
</ol>
<h3 id="etapes-pour-mettre-a-jour-les-secrets-injectes-dans-les-pods">Étapes pour mettre à jour les secrets injectés dans les pods</h3>
<p>Pour mettre à jour les secrets qui sont injectés dans les pods, vous devez
mettre à jour le manifeste des secrets pour l'application. Le manifeste des
secrets est un fichier YAML qui définit les secrets qui sont injectés dans
les pods en tant que variables d'environnement. Nous prendrons
Finesse comme exemple.</p>
<ol>
<li>Ouvrez une issue avec le modèle suivant : <a href="url à fournir lorsque le modèle sera créé">Modèle de mise à jour des
   secrets</a>. Vous pouvez ensuite
   créer une branche de travail à partir de l'issue.</li>
<li>Ouvrir <code>/kubernetes/aks/apps/finesse/base/finesse-secrets.yaml</code>.</li>
<li>Mettez à jour les références des clés de secrets selon les besoins.
   Par exemple, pour ajouter un nouveau secret, vous pouvez ajouter une
   nouvelle paire clé-valeur à la section data du manifeste des secrets :</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nt">FINESSE_BACKEND_AZURE_SEARCH_TRANSFORM_MAP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;FINESSE_BACKEND_AZURE_SEARCH_TRANSFORM_MAP&gt;</span>
</code></pre></div>
<p>La clé représente le nom de la variable d'environnement qui sera injectée
   dans le pod, et la valeur représente la clé du secret dans Vault qui sera
   utilisée pour récupérer la valeur du secret.</p>
<ol>
<li>Mettez à jour l'annotation de version des secrets récupérés depuis Vault :</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1"># Augmentez la version du secret de</span>
<span class="nt">avp.kubernetes.io/secret-version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4&quot;</span>
<span class="c1"># À</span>
<span class="nt">avp.kubernetes.io/secret-version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;5&quot;</span>
</code></pre></div>
<p>Ceci est la nouvelle version que nous créons à l'étape 5 de la section
   précédente.</p>
<p>À titre d'exemple supplémentaire, voici un problème et une pull request
   qui illustrent le processus de mise à jour des secrets dans
   l'application Nachet :</p>
<ul>
<li><a href="https://github.com/ai-cfia/howard/issues/133">Issue</a></li>
<li><a href="https://github.com/ai-cfia/howard/pull/131">Pull request</a></li>
</ul>
<h2 id="plugin-argo-cd-vault-avp">Plugin Argo CD Vault (AVP)</h2>
<p>Le <a href="https://argocd-vault-plugin.readthedocs.io/en/stable/">argocd-vault-plugin</a>
est utilisé pour gérer les secrets au sein de nos déploiements de manière
GitOps. Il permet d'utiliser des <code>&lt;placeholders&gt;</code> dans n'importe quel
fichier YAML ou JSON qui a été modélisé et fait usage d'annotations pour
fournir le chemin et la version d'un secret dans le Vault.</p>
<p>Un exemple d'utilisation est présenté dans l'application de démonstration. La
<a href="https://argocd-vault-plugin.readthedocs.io/en/stable/howitworks/">documentation</a>
du plugin est bien expliquée et peut être suivie en fonction du cas
d'utilisation nécessaire.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "header.autohide"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>