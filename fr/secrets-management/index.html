
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>Gestion des secrets - Howard</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gestion-des-secrets" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href=".." title="Howard" class="md-header__button md-logo" aria-label="Howard" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Howard
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Gestion des secrets
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Sélectionner la langue">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/howard/en/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/howard/fr/" hreflang="fr" class="md-select__link">
              French
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ai-cfia/howard" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    ai-cfia/howard
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Howard" class="md-nav__button md-logo" aria-label="Howard" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Howard
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ai-cfia/howard" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    ai-cfia/howard
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accueil
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../adr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ADR
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration / Implémentation
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-dazure-key-vault" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture d'Azure Key Vault
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#processus-de-gestion-des-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      Processus de gestion des secrets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creer-lire-mettre-a-jour-et-supprimer-des-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      Créer, lire, mettre à jour et supprimer des secrets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Créer, lire, mettre à jour et supprimer des secrets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#etapes-pour-mettre-a-jour-les-valeurs-des-secrets-en-utilisant-le-portail-azure" class="md-nav__link">
    <span class="md-ellipsis">
      Étapes pour mettre à jour les valeurs des secrets en utilisant le portail Azure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etapes-pour-mettre-a-jour-les-secrets-injectes-dans-les-pods" class="md-nav__link">
    <span class="md-ellipsis">
      Étapes pour mettre à jour les secrets injectés dans les pods
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plugin-argo-cd-vault-avp" class="md-nav__link">
    <span class="md-ellipsis">
      Plugin Argo CD Vault (AVP)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="gestion-des-secrets">Gestion des secrets</h1>
<h2 id="introduction">Introduction</h2>
<p>Les secrets sont des informations sensibles qui doivent être protégées contre un
accès non autorisé. Dans le contexte d'un cluster Kubernetes, les secrets sont
utilisés pour stocker des données sensibles telles que des mots de passe, des
jetons et des clés. Pour permettre une gestion sécurisée et efficace des
secrets, nous utilisons Azure Key Vault. Azure Key Vault est un outil conçu pour
gérer les secrets et protéger les données sensibles. Il fournit un moyen
centralisé de gérer l'accès aux secrets. Ce document fournit un aperçu du
processus de gestion des secrets et du rôle d'Azure Key Vault dans la
sécurisation et la gestion des secrets dans le cluster Kubernetes.</p>
<h2 id="architecture-dazure-key-vault">Architecture d'Azure Key Vault</h2>
<p>Azure Key Vault est un service basé sur le cloud qui fournit un stockage
sécurisé pour les secrets, les clés et les certificats. Il est conçu pour aider
à protéger les clés cryptographiques et les secrets utilisés par les
applications et services cloud. Key Vault simplifie le processus de gestion des
clés, vous permettant de maintenir le contrôle des clés et autres secrets en
centralisant le stockage et l'accès.</p>
<p>La configuration actuelle permet à Azure Key Vault d'injecter des secrets dans
les pods en utilisant le driver CSI (Container Storage Interface) Secret Store.
Cela fournit un moyen sécurisé de gérer les secrets dans le cluster Kubernetes
et garantit que les données sensibles sont protégées contre un accès non
autorisé.</p>
<p>Le diagramme suivant illustre la structure de l'architecture d'Azure Key Vault
dans notre configuration :</p>
<p><img alt="Diagramme de l'architecture de Vault" src="../img/vault-argocd-architecture.svg" /></p>
<p>Le diagramme de séquence suivant décrit le processus permettant à un développeur
de mettre à jour les secrets en utilisant le portail Azure et comment les
secrets sont injectés dans les pods :</p>
<pre class="mermaid"><code>```mermaid
sequenceDiagram
    participant Developer
    participant FinesseRepo as Référentiel Finesse
    participant GHWorkflow as Flux de travail GitHub
    participant ContainerReg as Registre de conteneurs GitHub
    participant HowardRepo as Référentiel Howard
    participant ArgoInstance as Instance ArgoCD
    participant CSIProvider as Fournisseur de secrets CSI
    participant FinessePod as Pod Finesse
    participant AzureKeyVaultUI as Interface utilisateur d'Azure Key Vault
    participant AzureKeyVault as Azure Key Vault

    Developer-&gt;&gt;+FinesseRepo: 1. Pousse les commits
    FinesseRepo-&gt;&gt;+GHWorkflow: Déclenche le flux de travail
    GHWorkflow-&gt;&gt;+ContainerReg: Construit et pousse une nouvelle version sémantique
    ArgoInstance-&gt;&gt;+ContainerReg: Vérifie les nouvelles balises d'image
    ArgoInstance-&gt;&gt;+FinessePod: Déclenche la synchronisation avec le pod
    FinessePod-&gt;&gt;+ContainerReg: Récupère l'image avec la nouvelle balise de version
    FinessePod-&gt;&gt;+FinessePod: Actualise le déploiement avec la nouvelle version
    Developer-&gt;&gt;+AzureKeyVaultUI: 2. Accède à l'interface pour mettre à jour/créer des secrets
    AzureKeyVaultUI-&gt;&gt;+AzureKeyVault: Valide la mise à jour/création des secrets
    Developer-&gt;&gt;+HowardRepo: 3. Commet les nouveaux/mis à jour secrets
    ArgoInstance-&gt;&gt;+HowardRepo: Vérifie les modifications dans le référentiel
    ArgoInstance-&gt;&gt;+CSIProvider: déclenche la mise à jour dans l'espace de noms finesse,&lt;br&gt; synchronise les secrets depuis Azure Key Vault
    CSIProvider-&gt;&gt;+AzureKeyVault: Récupère la version spécifique des secrets
    CSIProvider-&gt;&gt;+FinessePod: Injecte les secrets
    ArgoInstance-&gt;&gt;+FinessePod: 4. Déclenche une actualisation complète</code></pre>
<h2 id="processus-de-gestion-des-secrets">Processus de gestion des secrets</h2>
<p>Le processus de gestion des secrets implique les étapes suivantes :</p>
<ol>
<li>
<p><strong>Création des secrets</strong> : Les secrets sont créés et stockés dans Azure Key
   Vault en utilisant l'interface CLI ou API d'Azure Key Vault. Lorsqu'un secret
   est créé, il est chiffré et stocké dans le serveur central Key Vault.</p>
</li>
<li>
<p><strong>Récupération des secrets</strong> : Les secrets sont récupérés par les
   applications et services en utilisant la classe SecretProvider qui utilise
   l'identité gérée pour récupérer en toute sécurité les secrets depuis Azure
   Key Vault et les injecter dans les pods Kubernetes.</p>
</li>
<li>
<p><strong>Contrôle d'accès</strong> : Azure Key Vault fournit un contrôle d'accès granulaire
   aux secrets, permettant aux administrateurs de définir des politiques
   spécifiant quels clients peuvent accéder à quels secrets. Cela garantit que
   seuls les clients autorisés peuvent accéder aux données sensibles.
   Actuellement, nous utilisons la méthode d'authentification Managed Identity
   pour authentifier les applications hébergées et autoriser l'accès aux
   secrets.</p>
</li>
</ol>
<h2 id="creer-lire-mettre-a-jour-et-supprimer-des-secrets">Créer, lire, mettre à jour et supprimer des secrets</h2>
<p>Azure Key Vault fournit un service d'interface utilisateur pour gérer les
secrets. Le service d'interface utilisateur est une interface utilisateur basée
sur le web qui permet aux administrateurs de créer, lire, mettre à jour et
supprimer des secrets. Le service fournit également un moyen de gérer les
politiques de contrôle d'accès et les journaux d'audit. Le service est
accessible via un navigateur web et est protégé par les mêmes mécanismes de
sécurité que le service Key Vault.</p>
<h3 id="etapes-pour-mettre-a-jour-les-valeurs-des-secrets-en-utilisant-le-portail-azure">Étapes pour mettre à jour les valeurs des secrets en utilisant le portail Azure</h3>
<ol>
<li>
<p><strong>Accéder au portail Azure</strong> : Accédez au <a href="https://portal.azure.com/">portail
   Azure</a> dans votre navigateur web.</p>
</li>
<li>
<p><strong>Naviguer vers Azure Key Vault</strong> :</p>
</li>
<li>Dans le portail Azure, utilisez la barre de recherche en haut pour
     rechercher "Key Vaults".</li>
<li>
<p>Sélectionnez votre Key Vault dans la liste.</p>
</li>
<li>
<p><strong>Créer ou mettre à jour des secrets</strong> :</p>
</li>
<li>Dans votre Key Vault, sélectionnez l'option "Secrets" dans le menu de
     gauche.</li>
<li>Pour créer un nouveau secret, cliquez sur le bouton "+ Generate/Import".</li>
<li>Pour mettre à jour un secret existant, cliquez sur le nom du secret dans la
     liste, puis cliquez sur le bouton "New Version".</li>
<li>Entrez le nom et la valeur du secret. Assurez-vous que le nom du secret est
     préfixé par le nom de l'application (par exemple, <code>librechat-jwt-secret</code>)
     et cliquez sur "Create" ou "Save".</li>
</ol>
<p>Après avoir mis à jour les secrets dans Azure Key Vault, les secrets seront
automatiquement injectés dans les pods Kubernetes en fonction de la
configuration <code>SecretProviderClass</code>.</p>
<h3 id="etapes-pour-mettre-a-jour-les-secrets-injectes-dans-les-pods">Étapes pour mettre à jour les secrets injectés dans les pods</h3>
<p>Pour mettre à jour les secrets qui sont injectés dans les pods, vous devez
mettre à jour le manifeste des secrets pour l'application. Le manifeste des
secrets est un fichier YAML qui définit les secrets qui sont injectés dans les
variables d'environnement du pod. Nous utiliserons Finesse comme exemple.</p>
<ol>
<li><strong>Ouvrir un problème et créer une branche de travail</strong> :</li>
<li>
<p>Ouvrez un problème avec le modèle suivant : <a href="URL à fournir lorsque le modèle sera créé">Modèle de mise à jour des
     secrets</a>. Vous pouvez ensuite
     créer une branche de travail à partir du problème.</p>
</li>
<li>
<p><strong>Modifier le manifeste SecretProviderClass</strong> :</p>
</li>
<li>Ouvrez <code>/kubernetes/aks/apps/finesse/base/secretProviderClass.yaml</code>.</li>
<li>
<p>Mettez à jour les références de clés de secrets au besoin. Par exemple,
     pour ajouter un nouveau secret, vous pouvez ajouter une nouvelle paire
     clé-valeur dans la section <code>data</code> du manifeste <code>SecretProviderClass</code> :</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="nt">data</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">objectName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">azure-openai-chatgpt-deployment</span><span class="w"> </span><span class="c1"># Cela représente le nom du secret dans Azure Key Vault</span>
<span class="w">     </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AZURE_OPENAI_CHATGPT_DEPLOYMENT</span><span class="w"> </span><span class="c1"># Cela représente le nom de la variable d&#39;environnement qui sera injectée dans le pod</span>
</code></pre></div>
</li>
<li>
<p>Ajoutez le objectName et la clé pour le nouveau secret dans la section
     'objects' du manifeste <code>SecretProviderClass</code> :</p>
<div class="highlight"><pre><span></span><code><span class="nt">objects</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">objectName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">azure-openai-chatgpt-deployment</span>
<span class="w">   </span><span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secret</span>
<span class="w">   </span><span class="l l-Scalar l-Scalar-Plain">version</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
</code></pre></div>
<p>Le <code>objectName</code> représente le nom du secret dans Azure Key Vault
 (assurez-vous qu'il est préfixé par le nom de l'application, par exemple,
 la <code>key</code> représente le nom de la variable d'environnement qui sera injectée
 dans le pod. Vous pouvez également spécifier <code>objectVersion</code> si vous
 souhaitez utiliser une version spécifique du secret.</p>
</li>
</ol>
<h2 id="plugin-argo-cd-vault-avp">Plugin Argo CD Vault (AVP)</h2>
<p>Le <a href="https://argocd-vault-plugin.readthedocs.io/en/stable/">plugin argocd-vault</a>
est utilisé pour gérer les secrets à l'intérieur de nos déploiements de manière
GitOps. Il permet d'utiliser des <code>&lt;placeholders&gt;</code> dans n'importe quel fichier
YAML ou JSON qui a été modélisé et de faire usage d'annotations pour fournir le
chemin et la version d'un secret dans le vault. Pour l'instant, il n'est utilisé
que pour les déploiements helm qui n'ont pas d'intégration pour l'injection de
secrets. Le plugin est installé dans l'instance ArgoCD et est configuré pour
utiliser Azure Key Vault comme backend pour les secrets.</p>
<p>Un exemple d'utilisation est montré dans le déploiement de vouch-proxy sous
<code>kubernetes\aks\system\vouch-proxy\argo-app.yaml</code>.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "header.autohide"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>